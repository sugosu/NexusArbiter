{"mode":"strict","metadata":{"system_name":"library_manager","source_type":"derived_from_story","language":"python","version":"1.0.0"},"classes":[{"id":"main.Main","file_path":"main.py","class_name":"Main","role":"entry_point","purpose":"Application entry point. Wires dependencies and starts the application non-interactively.","depends_on":["application.Application","adapters.console.ConsolePrinter"],"interactions":[{"target_id":"application.Application","interaction_method":"run(storage_path)","interaction_way":"method call","semantics":"Starts the application's high-level run sequence; passes datastore path to orchestrator."},{"target_id":"adapters.console.ConsolePrinter","interaction_method":"print_info(message)/print_error(message)","interaction_way":"method call","semantics":"Prints startup messages and any fatal errors to stdout."}],"notes":["Wires domain services, repositories, storage adapter, and console printer before invoking the run sequence.","Must not contain business logic; only orchestration."]},{"id":"application.Application","file_path":"application.py","class_name":"Application","role":"orchestration","purpose":"Orchestrates high-level flow: loads data through services, executes non-interactive operations (e.g., create loans), persists changes, and prints concise summaries.","depends_on":["services.LibraryService","adapters.console.ConsolePrinter"],"interactions":[{"target_id":"services.LibraryService","interaction_method":"run_operations(storage_path)","interaction_way":"method call","semantics":"Delegates domain operations and rule enforcement to the LibraryService, passing storage path as method parameter."},{"target_id":"adapters.console.ConsolePrinter","interaction_method":"print_summary(summary)","interaction_way":"method call","semantics":"Outputs concise operation summaries to stdout after operations complete."}],"notes":["Application drives a non-interactive sequence and owns the overall run invocation.","Passes storage_path explicitly to lower layers as a method-level parameter."]},{"id":"services.LibraryService","file_path":"services/library_service.py","class_name":"LibraryService","role":"domain_service","purpose":"Encapsulates domain logic for books, members, and loans; enforces that loans cannot be created if no available copies or if a member has reached their loan limit.","depends_on":["repositories.BookRepository","repositories.MemberRepository","repositories.LoanRepository"],"interactions":[{"target_id":"repositories.BookRepository","interaction_method":"find(book_id, storage_path)/update(book, storage_path)","interaction_way":"method call","semantics":"Checks and updates book availability by reading and writing book records via the repository, passing storage path explicitly."},{"target_id":"repositories.MemberRepository","interaction_method":"find(member_id, storage_path)/update(member, storage_path)","interaction_way":"method call","semantics":"Checks member's current loan count and updates member records through the repository with explicit storage path."},{"target_id":"repositories.LoanRepository","interaction_method":"list_active_by_member(member_id, storage_path)/create(loan, storage_path)","interaction_way":"method call","semantics":"Queries active loans and creates new loan records via the loan repository, passing storage path explicitly."}],"notes":["Service methods receive storage_path as a method-level parameter and do not assume global path ownership.","Enforces invariants: available copies > 0 and member active loans < member.loan_limit before creating a loan."]},{"id":"repositories.BookRepository","file_path":"repositories/book_repository.py","class_name":"BookRepository","role":"repository","purpose":"Persistence abstraction for book records. Maps between domain Book objects and JSON storage.","depends_on":["storage.JsonStorage"],"interactions":[{"target_id":"storage.JsonStorage","interaction_method":"read(path)/write(path, data)","interaction_way":"method call","semantics":"Loads and persists book collections as JSON; repository passes explicit file paths to the storage adapter."}],"notes":["Public methods accept storage_path (or file path) as method parameters; repository does not own global path state."]},{"id":"repositories.MemberRepository","file_path":"repositories/member_repository.py","class_name":"MemberRepository","role":"repository","purpose":"Persistence abstraction for member records and loan counters. Maps between domain Member objects and JSON storage.","depends_on":["storage.JsonStorage"],"interactions":[{"target_id":"storage.JsonStorage","interaction_method":"read(path)/write(path, data)","interaction_way":"method call","semantics":"Loads and persists member collections as JSON; repository passes explicit file paths to the storage adapter."}],"notes":["Public methods accept storage_path as method parameters; no global path ownership."]},{"id":"repositories.LoanRepository","file_path":"repositories/loan_repository.py","class_name":"LoanRepository","role":"repository","purpose":"Persistence abstraction for loan records. Supports querying active loans and creating loan entries backed by JSON storage.","depends_on":["storage.JsonStorage"],"interactions":[{"target_id":"storage.JsonStorage","interaction_method":"read(path)/write(path, data)","interaction_way":"method call","semantics":"Loads and persists loan collections as JSON; repository passes explicit file paths to the storage adapter."}],"notes":["Repository is responsible for mapping between raw JSON and Loan domain objects."]},{"id":"storage.JsonStorage","file_path":"storage/json_storage.py","class_name":"JsonStorage","role":"storage_adapter","purpose":"Low-level JSON file adapter responsible for reading and writing JSON-serializable data to the filesystem.","depends_on":[],"interactions":[],"notes":["Deals only with generic JSON-serializable structures and file paths provided by callers.","No domain logic; callers own path and higher-level semantics."]},{"id":"adapters.console.ConsolePrinter","file_path":"adapters/console.py","class_name":"ConsolePrinter","role":"logging_adapter","purpose":"Prints concise operation summaries and informational messages to stdout.","depends_on":[],"interactions":[],"notes":["Used by entry point and application to present non-verbose output to the user."]},{"id":"domain.book.Book","file_path":"domain/book.py","class_name":"Book","role":"domain_model","purpose":"Passive data holder representing a book record (title, author, copies_available, id, etc.).","depends_on":[],"interactions":[],"notes":["Domain model is passive and contains no behavior that is invoked by other components."]},{"id":"domain.member.Member","file_path":"domain/member.py","class_name":"Member","role":"domain_model","purpose":"Passive data holder representing a library member (id, name, loan_limit, current_loans, etc.).","depends_on":[],"interactions":[],"notes":["Domain model is passive and contains no behavior that is invoked by other components."]},{"id":"domain.loan.Loan","file_path":"domain/loan.py","class_name":"Loan","role":"domain_model","purpose":"Passive data holder representing a loan record (loan_id, book_id, member_id, loan_date, due_date, returned flag).","depends_on":[],"interactions":[],"notes":["Domain model is passive and used only as data exchanged between services and repositories."]}]}