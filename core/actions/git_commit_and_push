from typing import Mapping
from .base_action import BaseAction, ActionContext
from .registry import ActionRegistry

class GitCommitAndPushAction(BaseAction):
    action_type = "git_commit_and_push"

    def validate(self):
        if "paths" not in self.params:
            return False
        if "commit_message" not in self.params:
            return False
        return True

    def execute(self, ctx: ActionContext):
        logger = ctx.logger

        paths = self.params["paths"]
        message = self.params["commit_message"]

        ctx.git_manager.add_and_commit(message, paths)
        ctx.git_manager.push()

        logger.info(f"Committed and pushed: {paths}")

ActionRegistry.register(GitCommitAndPushAction)
